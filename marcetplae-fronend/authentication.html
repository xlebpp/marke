<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>С возвращением</title>
        <link rel="stylesheet" href="styler_market.css">        
    </head>

    <body>
        <div class = "auth">
            <form id = "authentic">
                <div class = "pare">
                    <label for = "Email">Логин: </label>
                    <input type="email" id = "Email" name="Email" required>
                </div>
                <div class = "pare">
                    <label for "PasswordHash">Пароль: </label>
                    <input type = "password" id = "PasswordHash" name = "PasswordHash" required>
                </div>

                <button type ="submit">Войти</button>
                <a href="market.html">
                    <button type="button">Вернуться на страницу регистрации</button>
                </a>
                

            </form>

            <script>
                document.getElementById("authentic").addEventListener("submit", async function (f) {
                    f.preventDefault();

                    const user1 = {
                        email: f.target.Email.value,
                        passwordHash: f.target.PasswordHash.value
                    };

                    
                    const response = await fetch("https://localhost:7104/api/authentic", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        credentials: "include",
                        body: JSON.stringify(user1)
                    });
                    
                    if(response.ok){
                        const token = await response.text();
                        
                        window.location.href = "main.html";
                        localStorage.setItem("token", token);                       
                        
                    }
                    else{
                        document.getElementById("PasswordHash").value="";
                        alert("Неправильный логин или пароль.\nПопробуйте еще раз")
                    }
                    
                })
            </script>
        </div>
    </body>
</html>