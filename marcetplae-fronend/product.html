<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Продукт</title>
        <link rel ="stylesheet" href="styler-main.css"
    </head>

    <body>
        <div class="wrapper">
            <header class = "containeer">
                <span class = "logo">Create</span>
                                
                <nav>
                    <ul>
                        
                        <li><a href ="main.html" onclick = "showMenu(event)" style="text-decoration: none;">Главная</a></li>
                        <li class="search-item">
                            <form id ="searchForm" class="searchForm" action="/search" method="get">
                                <input id = "search_input" class = "search_input" type="search" placeholder="Введите что-нибудь для поиска">
                                <button id="search_button" class= "searcher" type="submit">Искать</button>
                            </form>
                        </li>
                        
                        <li class = "profile">
                            <a class="prof" href="profile.html" style="text-decoration: none;">
                                <img id="avatar" src ="C:\Users\Dasha\Downloads\ava.jpg" style="width:40px; height:40px; border-radius:50%">
                                <span>Профиль</span>
                            </a>
                        </li>
                        <li class = "basket">
                            <a href="basket.html" style="text-decoration: none;">
                                <img src="pict/bask1.jpg" alt="Корзина" class="basket_icon">
                                <span class ="basket_txt">Корзина</span>                                
                            </a>
                        </li>
                                              

                    </ul>
                </nav>               
            </header>
        </div>  
        <div id ="product_container"></div>
        
        <div id="results" style ="display: none;"></div>

        <script src = "search.js"></script>
        <script src = "showpr.js" ></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                showpr();   // ← вызов загрузки товаров при старте
            });
        </script>
        <script>
                            
                document.getElementById("searchForm").addEventListener("submit",function(e){
                    e.preventDefault();
                    const query = document.getElementById("search_input").value;
                    search(query)
                })
                
        </script>

        <script> /*аватарка*/
            document.addEventListener("DOMContentLoaded", async()=>{
                try{
                    const token = localStorage.getItem("token");
                   
                    const response = await fetch ("https://localhost:7104/api/user/avatar",{
                        method:"GET",
                        headers:{
                            "Authorization": "Bearer " + token
                        }
                    });

                    if(response.ok){
                        const data = await response.json();
                        console.log("full response:", data);
                        console.log("photo field:", data.value.photo);
                        if(data.value.photo){
                            document.getElementById("avatar").src=`data:image/png;base64,${data.value.photo}`;
                           
                        }
                        else{
                            document.getElementById("avatar").src = "/Photos/ava.jpg"
                        }
                    }
                    else{
                        console.error("Ошибка при получении фото");
                    }
                }
                catch(err){
                    console.error("Ошибка запроса", err);
                }
            });
        </script>
       
        <script type="module" src="product.js"></script>    
 

       
    </body>
</html>